parameters:
  - name: azureSubscription
    type: string
    default: $(AZURE_SUBSCRIPTION)
  - name: resourceGroup
    type: string
    default: $(RESOURCE_GROUP)
  - name: aksClusterName
    type: string
    default: $(AKS_CLUSTER_NAME)

steps:
- task: AzureCLI@2
  displayName: 'Login to Azure and Configure kubectl'
  inputs:
    azureSubscription: ${{ parameters.azureSubscription }}
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      set -e
      
      echo "Logging into Azure..."
      az account show
      
      echo "Getting AKS credentials..."
      az aks get-credentials -n ${{ parameters.aksClusterName }} -g ${{ parameters.resourceGroup }} --overwrite-existing
      
      echo "Configuring kubelogin for Azure CLI authentication..."
      kubelogin convert-kubeconfig -l azurecli
      
      echo "Azure authentication and kubectl configuration completed" 