parameters:
  workingDirectory: ''
  checkovFramework: 'terraform'  # Framework for Checkov
  failOnHigh: true  # Whether to fail pipeline on high severity issues

steps:
- script: |
    echo "Installing Checkov..."
    pip install checkov
    echo "Running Checkov security scan..."
    checkov -d . --framework ${{ parameters.checkovFramework }} --output json --output-file checkov-results.json --soft-fail
    echo "Checkov scan completed. Results:"
    if [ -f "checkov-results.json" ]; then
      cat checkov-results.json
    else
      echo "No JSON results file found. Checkov may have output to console only."
    fi
  displayName: 'Run Checkov Security Scan'
  workingDirectory: ${{ parameters.workingDirectory }} 